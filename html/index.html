<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è, –ó–∞—Ö–∞—Ä—á–∏–∫!</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>–° –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è, –ó–∞—Ö–∞—Ä—á–∏–∫! üéâ</h1>
            <div class="birthday-cake">üéÇ</div>
        </header>

        <section class="wishes-section">
            <h2>–î–æ—Ä–æ–≥–æ–π –ó–∞—Ö–∞—Ä—á–∏–∫!</h2>
            <p>–í —ç—Ç–æ—Ç –æ—Å–æ–±–µ–Ω–Ω—ã–π –¥–µ–Ω—å —Ö–æ—Ç–∏–º –ø–æ–∂–µ–ª–∞—Ç—å —Ç–µ–±–µ –º–æ—Ä–µ —Å—á–∞—Å—Ç—å—è, 
               –æ–∫–µ–∞–Ω –ª—é–±–≤–∏ –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Ä–∞–¥–æ—Å—Ç–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤! 
               –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –±—É–¥–µ—Ç –Ω–∞–ø–æ–ª–Ω–µ–Ω —É–ª—ã–±–∫–∞–º–∏ –∏ —É—Å–ø–µ—Ö–∞–º–∏!</p>
        </section>

        <section class="add-wish">
            <h3>–û—Å—Ç–∞–≤—å —Å–≤–æ—ë –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
            <form id="wishForm">
                <textarea id="wishText" placeholder="–ù–∞–ø–∏—à–∏ —Å–≤–æ—ë –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–¥–µ—Å—å..."></textarea>
                <input type="text" id="wishAuthor" placeholder="–¢–≤–æ—ë –∏–º—è">
                <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
            </form>
        </section>

        <section class="wishes-list">
            <h3>–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç –¥—Ä—É–∑–µ–π</h3>
            <div id="wishesList"></div>
        </section>
    </div>

    <script>
       async function fetchGreetings() {
           const response = await fetch('/api/greetings/');
           const greetings = await response.json();
           const wishesList = document.getElementById('wishesList');
           wishesList.innerHTML = '';
           greetings.forEach(greeting => {
               const wishElement = document.createElement('div');
               wishElement.className = 'wish-card';
               wishElement.innerHTML = `
                   <p>${greeting.message}</p>
                   <span class="author">- ${greeting.name}</span>
               `;
               wishesList.prepend(wishElement);
           });
       }

       document.getElementById('wishForm').addEventListener('submit', async function(e) {
           e.preventDefault();
           
           const wishText = document.getElementById('wishText').value;
           const author = document.getElementById('wishAuthor').value;
           
           if (wishText && author) {
               const response = await fetch('/api/send_greeting/', {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/x-www-form-urlencoded',
                   },
                   body: new URLSearchParams({
                       'name': author,
                       'message': wishText
                   })
               });

               if (response.ok) {
                   fetchGreetings(); // Refresh the list of greetings
                   document.getElementById('wishText').value = '';
                   document.getElementById('wishAuthor').value = '';
               }
           }
       });

       // Fetch greetings when the page loads
       window.onload = fetchGreetings;
    </script>
</body>
</html>
